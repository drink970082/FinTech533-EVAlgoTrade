---
title: "Strategy"
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    theme: cosmo
---


## Pair Trading Strategy Overview

::: {.callout-note title="Trading Setup"}
- **Data Frequency**: Daily resolution
- **Hedge Ratio Update**: Every two weeks
- **Cointegration Test Frequency**: Every two weeks
- **Trading Session Timeout**: 10 days
:::

---

## Strategy Logic

1. **Calculate Hedge Ratio**
   Compute the hedge ratio $\beta_i$ based on the past 20 days of log prices:
   $$
   \beta_i = \frac{\text{Cov}(\log P_{\text{RIVN}}, \log P_{\text{TSLA}})}{\text{Var}(\log P_{\text{TSLA}})}
   $$

2. **Compute Spread**
   $$
   \text{Spread}_t = \log(P_{\text{RIVN}, t}) - \beta_i \cdot \log(P_{\text{TSLA}, t})
   $$

3. **Cointegration Test**
   Test 60-day rolling window of log prices for cointegration using the ADF test.

4. **Z-Score Based Trading Rules**
   If cointegration is statistically significant:
   - **Entry**: if $Z > 2$ or $Z < -2$
   - **Exit**: if $|Z| < 0.5$
   - **Stop Loss**: if $|Z| > 3$

5. **Trading Session Timeout**
   Force close any open positions after 10 trading days.


## Blotter (Example)

```{=html}
<div style="max-width: 900px; overflow-x: auto; margin: 0 auto; border: 1px solid #ddd; padding: 1rem; border-radius: 6px;">
 <table border="1" class="dataframe" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamp</th>
      <th>close_RIVN</th>
      <th>close_TSLA</th>
      <th>log_close_TSLA</th>
      <th>log_close_RIVN</th>
      <th>hedge_ratio</th>
      <th>spread</th>
      <th>z_score</th>
      <th>adf_stat</th>
      <th>p_value</th>
      <th>position</th>
      <th>trade_entry</th>
      <th>trade_exit</th>
      <th>pnl</th>
      <th>cumulative_pnl</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>60</th>
      <td>2022-07-08</td>
      <td>31.99</td>
      <td>250.76</td>
      <td>5.524496</td>
      <td>3.465423</td>
      <td>1.108226</td>
      <td>-2.656969</td>
      <td>-1.225487</td>
      <td>-1.551199</td>
      <td>0.508049</td>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>61</th>
      <td>2022-07-11</td>
      <td>29.93</td>
      <td>234.34</td>
      <td>5.456773</td>
      <td>3.398861</td>
      <td>1.132528</td>
      <td>-2.781088</td>
      <td>-1.369341</td>
      <td>-1.838264</td>
      <td>0.361637</td>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>62</th>
      <td>2022-07-12</td>
      <td>30.15</td>
      <td>233.07</td>
      <td>5.451339</td>
      <td>3.406185</td>
      <td>1.141880</td>
      <td>-2.818590</td>
      <td>-1.551397</td>
      <td>-1.676010</td>
      <td>0.443513</td>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>63</th>
      <td>2022-07-13</td>
      <td>30.76</td>
      <td>237.04</td>
      <td>5.468229</td>
      <td>3.426215</td>
      <td>1.245694</td>
      <td>-3.385527</td>
      <td>-2.298003</td>
      <td>-1.857733</td>
      <td>0.352199</td>
      <td>1</td>
      <td>True</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>64</th>
      <td>2022-07-14</td>
      <td>30.83</td>
      <td>238.31</td>
      <td>5.473572</td>
      <td>3.428488</td>
      <td>1.327210</td>
      <td>-3.836090</td>
      <td>-2.618729</td>
      <td>-2.188877</td>
      <td>0.210307</td>
      <td>1</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>749</th>
      <td>2025-04-07</td>
      <td>11.21</td>
      <td>233.29</td>
      <td>5.452282</td>
      <td>2.416806</td>
      <td>0.711856</td>
      <td>-1.464435</td>
      <td>-1.436818</td>
      <td>-0.656144</td>
      <td>0.857785</td>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>19.805438</td>
    </tr>
  </tbody>
</table>
<p>690 rows Ã— 15 columns</p>
</div>


## Graphs

### TSLA vs. RIVN Stock Log Prices
<iframe src="/images/log_price.html" width="100%" height="500" frameborder="0"></iframe>

### Rolling ADF Test on Spread (window=60)
<iframe src="/images/adf_test.html" width="100%" height="500" frameborder="0"></iframe>

### Spread and Trade Entry/Exit Points
<iframe src="/images/spread.html" width="100%" height="500" frameborder="0"></iframe>

### PnL Over Time
<iframe src="/images/cumulative_pnl.html" width="100%" height="500" frameborder="0"></iframe>


